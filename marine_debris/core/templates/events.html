{% extends "base.html" %}

{% block styles %}
    <link href="/site-media/third-party/chosen/chosen.css" rel="stylesheet" />
    <link href="/site-media/third-party/jquery/css/jquery.dataTables.css" rel="stylesheet" />

{% endblock %}

{% block includes %}
    <script src="/site-media/third-party/OpenLayers-2.12/OpenLayers.js" type="text/javascript" charset="utf-8"></script>
    <script type="text/javascript" charset="utf-8">
        // Hack to support IE. See http://trac.openlayers.org/wiki/FrequentlyAskedQuestions#WhywontmyvectorlayerworkinIEbeforemypageisdoneloading
        document.namespaces;
    </script>
    {% if map %}
        <script src="{{STATIC_URL}}js/gwst/widgets/Map.js" type="text/javascript" charset="utf-8"></script>
    {% endif %}
{% endblock %}

    
{% block leftcontent %}
<h2>Query Database <img src="/site-media/img/ajax-loader.gif" data-bind="visible: showSpinner"/></h2>
 <div class="row-fluid">
   <div class="span12">
     <div class="filter-container">
     <h4>Filter by Report Type</h4>
      <select class="type" multiple="true" data-placeholder="Filter by event type(s)..." style="width: 350px">
        <option value="Gear Removal">Gear Removal</option>
        <option value="Beach Cleanups">Beach Cleanups</option>
      </select>
     </div>
     <div class="filter-container">
       <h4>Filter by State and County</h4>
       <select class="location" data-placeholder="Filter by location(s)..." data-bind="foreach: states" multiple style="width: 350px">
           <optgroup data-bind="attr: {label: $data.name}">
             <option data-bind="text: $data.name, value: 'state:'+$data.name" disabled></option>
           <!-- ko foreach: $root.locations[$data.name].counties -->
             <option data-bind="text: $data.name + ', ' + $parent.initials, value: $data.state+':'+$data.name"></option>
           <!-- /ko -->
           </optgroup>
       </select>
     </div>
   </div>
 </div>
  <div class="events-table">
        <table class="table wcga table-striped table-hover table-condensed" id="events-table" data-bind="dataTable: { 
            rowTemplate: 'rowTemplate', options: dataTablesOptions, 
            columns: [
                { mDataProp: 'datasheet.event_type', sTitle: 'Event Type'},
                { mDataProp: 'site.name', sTitle: 'Site'},
                { mDataProp: 'site.county', sTitle: 'County'},
                { mDataProp: 'site.st_initials', sTitle: 'State' },
                { mDataProp: 'date', sTitle: 'Date' }
              ]
        }">    
    </table>
  </div>

<div class="row-fluid buttons">
<p class="pull-right">
  <a href="/datasheet/bulk_import" class="btn" disabled>
    <i class="icon-share-alt"></i> Import Events
  </a>
  <a href="/event/create" class="btn">
    <i class="icon-plus"></i> Create Event 
  </a>
</p>
</div>
{% endblock %}    
{% block rightcontent %}
    {%if data %}
        <p>data!</p>
    {% else %}
        {% if report %}
            <p>report!</p>
        {% else %}
          <div class="tabbable wcga">
            <ul class="nav nav-tabs">
                <li class="active">
                  <a href="#map-content" data-toggle="tab">Map</a>
                </li>
                <li>
                  <a href="#event-details-content" data-toggle="tab">Event Details</a>
                </li>
                <li> 
                  <a href="#report-values-content" data-toggle="tab">Report</a>
                </li>                
              </ul>
            <div class="tab-content">
              <div class="tab-pane active" id="map-content">
                <div id="map"></div>
               <!-- <div class="clearfix filter-box">
                  <p class="pull-right">
                  <label class="checkbox" disabled>
                      <input type="checkbox" data-bind="checked: filterByExtent" disabled> Only show reports within extent of map
                    </label>
                  </p>
                </div>      -->
              </div>
              <div class="tab-pane" id="event-details-content">
                <div data-bind="ifnot: activeEvent">
                  <p>Click on an event in the table for details.</p>
                </div>
                <div data-bind="if: activeEvent">
                  <div data-bind="with: activeEvent">
                    <h4><span data-bind="text: site.name"></span></h4>
                    <dl class="dl-horizontal">
                      <dt>location</dt>
                      <dd><span data-bind="text: site.county"></span>, <span data-bind="text: site.state"></span></dd>
                      
                      <dt>project</dt>
                      <dd><span data-bind="text: project.name"></span></dd>
                      <dt>date</dt>
                      <dd><span data-bind="text: date"></span></dd>
                    </dl>
                    <div data-bind="if: data">
                      <table class="table wcga table-striped table-hover table-condensed" data-bind="dataTable: { dataSource: data, columns: [{mDataProp: 'text', sTitle: 'Text'}, {mDataProp:'value', sTitle: 'Value'}, { bSortable: false, mDataProp: 'unit' }] }">
                        <tbody>
                          <tr data-bind="visible: value">
                            <td data-bind="text: text"></td>
                            <td><span data-bind="text: value"></span> <span data-bind="text: unit"></span></td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="tab-pane" id="report-values-content">
            
                <!-- ACTIONS:
                    Get spinner up when loading report.
                    On page load, load cached report for all cleanups.
                    On filter, get report for filtered cleanups.
                -->
                <h4><span>Report</span></h4>
                
                
                
                <div data-bind="if: report">
                  <table class="table wcga table-striped table-hover table-condensed" data-bind="dataTable: { dataSource: report, rowTemplate: 'reportRowTemplate', columns: [{mDataProp: 'field.name', sTitle: 'Field'}, {mDataProp:'field.value', sTitle: 'Value'}, {mDataProp:'field.unit', sTitle: ''}] }">
                  </table>
                </div>

              </div>
              
            </div>            
              
            </div>
        {% endif %}
    {% endif %}

{% endblock %}

{% block scripts %}

<script src="/site-media/third-party/chosen/chosen.jquery.js"></script>
<script type="text/html" id="reportRowTemplate">
  <td data-bind="text: field.name.replace(/_/g,' ')"></td>
  <td data-bind="text: field.value"></td>
  <td data-bind="text: field.unit"></td>
</script>
<script type="text/html" id="rowTemplate">
  <td data-bind="text: datasheet.event_type, click: $root.zoomTo"></td>
  <td data-bind="text: site.name, click: $root.zoomTo"></td>
  <td data-bind="text: site.county, click: $root.zoomTo"></td>
  <td data-bind="text: site.st_initials, click: $root.zoomTo"></td>
  <td data-bind="text: date, click: $root.zoomTo"></td>
</script>
<script>
  var init_report = {{report_values|safe}};
</script>

<script src="/site-media/js/events.js"></script>
{% endblock %}

{% block js %}
{% endblock %}
    
